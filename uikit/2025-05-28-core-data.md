## Core Data

- ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•˜ê¸° ìœ„í•´ ì‚¬ìš©
- Object Graph ê´€ë¦¬ ë„êµ¬(ORM)ë¡œ, Swift ê°ì²´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì™€ ë§¤í•‘
- Object â†” ORM(Core Data) â†” DataBase

<br />

### Core Data Stack êµ¬ì„± ìš”ì†Œ

| êµ¬ì„± ìš”ì†Œ | ì„¤ëª… |
| --- | --- |
| Persistent Store | ì‹¤ì œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì €ì¥ì†Œ |
| Object Model | Entity, Attribute ë“± ë°ì´í„° êµ¬ì¡° ì •ì˜ |
| Persistent Store Coordinator | Object â†” Store ê°„ì˜ ë°ì´í„° ë³€í™˜ ë‹´ë‹¹ |
| Managed Object Context | ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì—­í•  |
- Persistent Store (ì˜êµ¬ ì €ì¥ì†Œ)
    - Atomic Store: ëª¨ë“  ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œí•˜ëŠ” ë°©ì‹
    - Non-atomic Store: íŒŒì¼ì— ì €ì¥, í•„ìš”í•œ ë¶€ë¶„ë§Œ ë©”ëª¨ë¦¬ì— ë¡œë“œ, SQLiteê°€ ê¸°ë³¸ê°’
<br />

### Core Dataì˜ ë°ì´í„° íë¦„
- Object â†” Context
    - `create`: ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ìƒì„±í•˜ë©´, ì´ ê°ì²´ëŠ” Contextì— ì„ì‹œë¡œ ì €ì¥
        
        ```swift
        let newMemo = MemoEntity(context: mainContext)
        ```
        
    - `read`: ì´ë¯¸ ì €ì¥ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•Œë„, Contextë¥¼ í†µí•´ ê°ì²´ë¡œ ê°€ì ¸ì™€ ì¡°ì‘

- Context â†” DataBase(Persistent Store)
    - `fetch`: DBì— ì €ì¥ëœ ë°ì´í„°ë¥¼ Contextë¡œ ì „ë‹¬
        
        ```swift
        let request = MemoEntity.fetchRequest()
        let list = context.fetch(request)
        ```
        
    - `save`: Contextì˜ ë³€ê²½ì‚¬í•­ì„ DBì— ì˜êµ¬ ì €ì¥
        
        ```swift
        context.save()
        ```

<br />

### NSPersistentContainer

- Core Data Stack ì´ˆê¸°í™” ì—­í• 
- ë©”ì¸ ìŠ¤ë ˆë“œìš© ìŠ¤ë ˆë“œ: `.viewContext`

<br />

```swift
// CoreData != DB
// CoreData == ORM (DB ì‚¬ìš©ì„ ì‰½ê²Œ ë„ì™€ì£¼ëŠ” ë„êµ¬)
// ê¸°ë³¸ ì €ì¥ì†Œ íƒ€ì…ì€ SQLite

// ì´ˆê¸°í™”: NSPersistentContainer
// ê¸°ë³¸ì‘ì—…: NSManagedObjectContext
// ë‚˜ë¨¸ì§€ ê°ì²´ë“¤ì€ ìë™ìœ¼ë¡œ ê´€ë¦¬

// ê¸°ë³¸ íë¦„:
// ìŠ¤íƒ ì´ˆê¸°í™”(ìë™) -> ëª¨ë¸ êµ¬ì„±(ëª¨ë¸ í¸ì§‘ê¸°) -> Contextì—ì„œ CRUD ìˆ˜í–‰

// ëª¨ë¸ êµ¬ì„± ì˜ˆì‹œ:
// Entity ì¶”ê°€ -> Attribute ì„¤ì • -> Custom Class ì´ë¦„ ì§€ì •
// -> Xcodeê°€ ìë™ìœ¼ë¡œ NSManagedObject ìƒì„±

// ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë§Œë“¤ë©´ DBì— ë°”ë¡œ ì €ì¥ë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ Contextì— ì„ì‹œë¡œ ì €ì¥ë¨
// DBì— ì €ì¥í•˜ë ¤ë©´ Contextë¥¼ ì €ì¥í•´ì•¼ í•¨
```

- ìƒˆë¡œìš´ ê°ì²´ëŠ” DBì— ì¦‰ì‹œ ì €ì¥ë˜ì§€ ì•Šê³ , Contextì— ì„ì‹œë¡œ ì €ì¥ë¨
- DBì— ë°˜ì˜í•˜ë ¤ë©´ `context.save()` í˜¸ì¶œ í•„ìš”

<br />

### Singleton íŒ¨í„´

- Type Propertyë¡œ ì ‘ê·¼í•˜ê³ , ìµœì´ˆë¡œ ì ‘ê·¼í•  ë•Œ ì´ˆê¸°í™”
    
    ```swift
    static let shared = DataManager()
    ```
    
- ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ê°€ì§
    
    ```swift
    // ì™¸ë¶€ì—ì„œ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡
    private init() {}
    ```
    
- ì¥ì 
    - ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ìƒì„± â†’ ë©”ëª¨ë¦¬ ì ˆì•½
    - ì–´ë””ì„œë“  ì ‘ê·¼ ê°€ëŠ¥
- ë‹¨ì 
    - ì „ì—­ ìƒíƒœ ê³µìœ  â†’ ì˜ˆì¸¡ ì–´ë ¤ìš´ ì‚¬ì´ë“œ ì´í™íŠ¸
    - ì‹±ê¸€í†¤ ê°ì²´ê°€ ë„ˆë¬´ ë§ì€ ê¸°ëŠ¥ì„ ì œê³µí•˜ë©´ í™•ì¥ì„±ì´ ë–¨ì–´ì§
    - Unit Test ì–´ë ¤ì›€

<br />

### ì¼ë°˜ì ì¸ Insert

- í•˜ë‚˜í•˜ë‚˜ì˜ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥
- ë§ì€ ê°ì²´ë¥¼ í•œêº¼ë²ˆì— ì €ì¥í•˜ë©´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë§ì•„ì§€ê³  ëŠë ¤ì§
- ê° ê°ì²´ë§ˆë‹¤ì˜ ê²€ì¦ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜

```swift
let memo = MemoEntity(context: mainContext)
for content in contents {
		memo.content = content
}
context.save()
```

<br />

### Batch Insert

- Contextë¥¼ ê±°ì¹˜ì§€ ì•Šê³ , ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ DBì— ì§ì ‘ ì‚½ì… â†’ ë¹ ë¦„ / ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± ì¢‹ìŒ
- ê°ì²´ ê²€ì¦ ìƒëµ
- ì´í›„ contextì— ë°”ë¡œ ë°˜ì˜í•˜ê³  ì‹¶ìœ¼ë©´ ë³„ë„ fetch í•„ìš”

```swift
var dataList = [[String: Any]]()
for content in contents {
		dataList.append(["content": content])
}
let insertRequest = NSBatchInsertRequest(entityName: "Memo", objects: dataList)
context.execute(insertRequest)
```

<br />

---

<br />

## ğŸ¤”Â Comment

- Notificationì„ í†µí•œ ë°ì´í„° ì „ë‹¬ ë³µìŠµ í•„ìš” â•
